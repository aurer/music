import { h, render, Component } from '../lib/preact.js';
import Tracks from './Tracks.js';
import Paging from './Paging.js';
import Scrobbler from '../services/scrobbler.js';
const scrobbler = new Scrobbler('philmau', 'ccfce33b35f8480c2413f2a642fa2c6a');

class App extends Component {
  constructor() {
    super();
    this.state = {
      page: 1,
      total: 0,
      perPage: 10,
      totalPages: 0,
      tracks: Array.apply({}, Array(10))
    };
  }

  componentWillMount() {
    this.fetchTracks();
  }

  handlePaging(page) {
    this.setState({
      page: page,
      tracks: Array.apply({}, Array(this.state.perPage))
    }, this.fetchTracks);
  }

  fetchTracks() {
    scrobbler.getRecentTracks(this.state.perPage, this.state.page).then(data => {
      let attr = data.recenttracks['@attr'];
      this.setState({
        page: parseInt(attr.page),
        total: parseInt(attr.total),
        perPage: parseInt(attr.perPage),
        totalPages: parseInt(attr.totalPages),
        tracks: data.recenttracks.track
      });
    });
  }

  render(props, {
    tracks,
    page,
    total,
    perPage,
    totalPages
  }) {
    return h("div", {
      class: "App"
    }, h(Paging, {
      page: page,
      totalPages: totalPages,
      onPage: this.handlePaging.bind(this)
    }), h(Tracks, {
      tracks: tracks.slice(0, this.state.perPage),
      page: page
    }));
  }

}

export default App;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvQXBwLmpzIl0sIm5hbWVzIjpbImgiLCJyZW5kZXIiLCJDb21wb25lbnQiLCJUcmFja3MiLCJQYWdpbmciLCJTY3JvYmJsZXIiLCJzY3JvYmJsZXIiLCJBcHAiLCJjb25zdHJ1Y3RvciIsInN0YXRlIiwicGFnZSIsInRvdGFsIiwicGVyUGFnZSIsInRvdGFsUGFnZXMiLCJ0cmFja3MiLCJBcnJheSIsImFwcGx5IiwiY29tcG9uZW50V2lsbE1vdW50IiwiZmV0Y2hUcmFja3MiLCJoYW5kbGVQYWdpbmciLCJzZXRTdGF0ZSIsImdldFJlY2VudFRyYWNrcyIsInRoZW4iLCJkYXRhIiwiYXR0ciIsInJlY2VudHRyYWNrcyIsInBhcnNlSW50IiwidHJhY2siLCJwcm9wcyIsImJpbmQiLCJzbGljZSJdLCJtYXBwaW5ncyI6IkFBQUEsU0FBU0EsQ0FBVCxFQUFZQyxNQUFaLEVBQW9CQyxTQUFwQixRQUFzQyxrQkFBdEM7QUFDQSxPQUFPQyxNQUFQLE1BQW1CLGFBQW5CO0FBQ0EsT0FBT0MsTUFBUCxNQUFtQixhQUFuQjtBQUNBLE9BQU9DLFNBQVAsTUFBc0IsMEJBQXRCO0FBQ0EsTUFBTUMsU0FBUyxHQUFHLElBQUlELFNBQUosQ0FBYyxTQUFkLEVBQXlCLGtDQUF6QixDQUFsQjs7QUFFQSxNQUFNRSxHQUFOLFNBQWtCTCxTQUFsQixDQUE0QjtBQUMzQk0sRUFBQUEsV0FBVyxHQUFHO0FBQ2I7QUFDQSxTQUFLQyxLQUFMLEdBQWE7QUFDWkMsTUFBQUEsSUFBSSxFQUFFLENBRE07QUFFWkMsTUFBQUEsS0FBSyxFQUFFLENBRks7QUFHWkMsTUFBQUEsT0FBTyxFQUFFLEVBSEc7QUFJWkMsTUFBQUEsVUFBVSxFQUFFLENBSkE7QUFLWkMsTUFBQUEsTUFBTSxFQUFFQyxLQUFLLENBQUNDLEtBQU4sQ0FBWSxFQUFaLEVBQWdCRCxLQUFLLENBQUMsRUFBRCxDQUFyQjtBQUxJLEtBQWI7QUFPQTs7QUFFREUsRUFBQUEsa0JBQWtCLEdBQUc7QUFDcEIsU0FBS0MsV0FBTDtBQUNBOztBQUVEQyxFQUFBQSxZQUFZLENBQUNULElBQUQsRUFBTztBQUNsQixTQUFLVSxRQUFMLENBQ0M7QUFDQ1YsTUFBQUEsSUFBSSxFQUFFQSxJQURQO0FBRUNJLE1BQUFBLE1BQU0sRUFBRUMsS0FBSyxDQUFDQyxLQUFOLENBQVksRUFBWixFQUFnQkQsS0FBSyxDQUFDLEtBQUtOLEtBQUwsQ0FBV0csT0FBWixDQUFyQjtBQUZULEtBREQsRUFLQyxLQUFLTSxXQUxOO0FBT0E7O0FBRURBLEVBQUFBLFdBQVcsR0FBRztBQUNiWixJQUFBQSxTQUFTLENBQUNlLGVBQVYsQ0FBMEIsS0FBS1osS0FBTCxDQUFXRyxPQUFyQyxFQUE4QyxLQUFLSCxLQUFMLENBQVdDLElBQXpELEVBQStEWSxJQUEvRCxDQUFvRUMsSUFBSSxJQUFJO0FBQzNFLFVBQUlDLElBQUksR0FBR0QsSUFBSSxDQUFDRSxZQUFMLENBQWtCLE9BQWxCLENBQVg7QUFDQSxXQUFLTCxRQUFMLENBQWM7QUFDYlYsUUFBQUEsSUFBSSxFQUFFZ0IsUUFBUSxDQUFDRixJQUFJLENBQUNkLElBQU4sQ0FERDtBQUViQyxRQUFBQSxLQUFLLEVBQUVlLFFBQVEsQ0FBQ0YsSUFBSSxDQUFDYixLQUFOLENBRkY7QUFHYkMsUUFBQUEsT0FBTyxFQUFFYyxRQUFRLENBQUNGLElBQUksQ0FBQ1osT0FBTixDQUhKO0FBSWJDLFFBQUFBLFVBQVUsRUFBRWEsUUFBUSxDQUFDRixJQUFJLENBQUNYLFVBQU4sQ0FKUDtBQUtiQyxRQUFBQSxNQUFNLEVBQUVTLElBQUksQ0FBQ0UsWUFBTCxDQUFrQkU7QUFMYixPQUFkO0FBT0EsS0FURDtBQVVBOztBQUVEMUIsRUFBQUEsTUFBTSxDQUFDMkIsS0FBRCxFQUFRO0FBQUVkLElBQUFBLE1BQUY7QUFBVUosSUFBQUEsSUFBVjtBQUFnQkMsSUFBQUEsS0FBaEI7QUFBdUJDLElBQUFBLE9BQXZCO0FBQWdDQyxJQUFBQTtBQUFoQyxHQUFSLEVBQXNEO0FBQzNELFdBQ0M7QUFBSyxNQUFBLEtBQUssRUFBQztBQUFYLE9BQ0MsRUFBQyxNQUFEO0FBQVEsTUFBQSxJQUFJLEVBQUVILElBQWQ7QUFBb0IsTUFBQSxVQUFVLEVBQUVHLFVBQWhDO0FBQTRDLE1BQUEsTUFBTSxFQUFFLEtBQUtNLFlBQUwsQ0FBa0JVLElBQWxCLENBQXVCLElBQXZCO0FBQXBELE1BREQsRUFFQyxFQUFDLE1BQUQ7QUFBUSxNQUFBLE1BQU0sRUFBRWYsTUFBTSxDQUFDZ0IsS0FBUCxDQUFhLENBQWIsRUFBZ0IsS0FBS3JCLEtBQUwsQ0FBV0csT0FBM0IsQ0FBaEI7QUFBcUQsTUFBQSxJQUFJLEVBQUVGO0FBQTNELE1BRkQsQ0FERDtBQU1BOztBQTlDMEI7O0FBaUQ1QixlQUFlSCxHQUFmIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgaCwgcmVuZGVyLCBDb21wb25lbnQgfSAgZnJvbSAnLi4vbGliL3ByZWFjdC5qcyc7XHJcbmltcG9ydCBUcmFja3MgZnJvbSAnLi9UcmFja3MuanMnO1xyXG5pbXBvcnQgUGFnaW5nIGZyb20gJy4vUGFnaW5nLmpzJztcclxuaW1wb3J0IFNjcm9iYmxlciBmcm9tICcuLi9zZXJ2aWNlcy9zY3JvYmJsZXIuanMnO1xyXG5jb25zdCBzY3JvYmJsZXIgPSBuZXcgU2Nyb2JibGVyKCdwaGlsbWF1JywgJ2NjZmNlMzNiMzVmODQ4MGMyNDEzZjJhNjQyZmEyYzZhJyk7XHJcblxyXG5jbGFzcyBBcHAgZXh0ZW5kcyBDb21wb25lbnQge1xyXG5cdGNvbnN0cnVjdG9yKCkge1xyXG5cdFx0c3VwZXIoKTtcclxuXHRcdHRoaXMuc3RhdGUgPSB7XHJcblx0XHRcdHBhZ2U6IDEsXHJcblx0XHRcdHRvdGFsOiAwLFxyXG5cdFx0XHRwZXJQYWdlOiAxMCxcclxuXHRcdFx0dG90YWxQYWdlczogMCxcclxuXHRcdFx0dHJhY2tzOiBBcnJheS5hcHBseSh7fSwgQXJyYXkoMTApKVxyXG5cdFx0fTtcclxuXHR9XHJcblxyXG5cdGNvbXBvbmVudFdpbGxNb3VudCgpIHtcclxuXHRcdHRoaXMuZmV0Y2hUcmFja3MoKTtcclxuXHR9XHJcblxyXG5cdGhhbmRsZVBhZ2luZyhwYWdlKSB7XHJcblx0XHR0aGlzLnNldFN0YXRlKFxyXG5cdFx0XHR7XHJcblx0XHRcdFx0cGFnZTogcGFnZSxcclxuXHRcdFx0XHR0cmFja3M6IEFycmF5LmFwcGx5KHt9LCBBcnJheSh0aGlzLnN0YXRlLnBlclBhZ2UpKVxyXG5cdFx0XHR9LFxyXG5cdFx0XHR0aGlzLmZldGNoVHJhY2tzXHJcblx0XHQpO1xyXG5cdH1cclxuXHJcblx0ZmV0Y2hUcmFja3MoKSB7XHJcblx0XHRzY3JvYmJsZXIuZ2V0UmVjZW50VHJhY2tzKHRoaXMuc3RhdGUucGVyUGFnZSwgdGhpcy5zdGF0ZS5wYWdlKS50aGVuKGRhdGEgPT4ge1xyXG5cdFx0XHRsZXQgYXR0ciA9IGRhdGEucmVjZW50dHJhY2tzWydAYXR0ciddO1xyXG5cdFx0XHR0aGlzLnNldFN0YXRlKHtcclxuXHRcdFx0XHRwYWdlOiBwYXJzZUludChhdHRyLnBhZ2UpLFxyXG5cdFx0XHRcdHRvdGFsOiBwYXJzZUludChhdHRyLnRvdGFsKSxcclxuXHRcdFx0XHRwZXJQYWdlOiBwYXJzZUludChhdHRyLnBlclBhZ2UpLFxyXG5cdFx0XHRcdHRvdGFsUGFnZXM6IHBhcnNlSW50KGF0dHIudG90YWxQYWdlcyksXHJcblx0XHRcdFx0dHJhY2tzOiBkYXRhLnJlY2VudHRyYWNrcy50cmFja1xyXG5cdFx0XHR9KTtcclxuXHRcdH0pO1xyXG5cdH1cclxuXHJcblx0cmVuZGVyKHByb3BzLCB7IHRyYWNrcywgcGFnZSwgdG90YWwsIHBlclBhZ2UsIHRvdGFsUGFnZXMgfSkge1xyXG5cdFx0cmV0dXJuIChcclxuXHRcdFx0PGRpdiBjbGFzcz1cIkFwcFwiPlxyXG5cdFx0XHRcdDxQYWdpbmcgcGFnZT17cGFnZX0gdG90YWxQYWdlcz17dG90YWxQYWdlc30gb25QYWdlPXt0aGlzLmhhbmRsZVBhZ2luZy5iaW5kKHRoaXMpfSAvPlxyXG5cdFx0XHRcdDxUcmFja3MgdHJhY2tzPXt0cmFja3Muc2xpY2UoMCwgdGhpcy5zdGF0ZS5wZXJQYWdlKX0gcGFnZT17cGFnZX0gLz5cclxuXHRcdFx0PC9kaXY+XHJcblx0XHQpO1xyXG5cdH1cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgQXBwO1xyXG4iXSwiZmlsZSI6ImNvbXBvbmVudHMvQXBwLmpzIn0=